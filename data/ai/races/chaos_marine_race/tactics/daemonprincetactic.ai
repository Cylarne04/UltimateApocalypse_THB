----------------------------------------
-- File: 'daemonprincetactic.ai'
-- Edited by Thudmeizer @ 20.03.2007
-- Edited by Cylarne_04 2011

class 'DaemonPrinceTactic' (ChaosMarineInfantryTactic)

DaemonPrince = {}

function DaemonPrinceTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Daemon Prince Tactic")
	
	self.m_oTimedSpecialAbilities = Timer( DaemonPrinceTactic.DoTimedSpecialAbilities, self, 7 )
	self.m_iDeepStrikeBlueprintID = cpu_manager.stats:GetBuildingID("chaos_hq_super")
end

function DaemonPrinceTactic:InitAbilities()

	-- Init ability ID's
	if (DaemonPrince.strength_id == nil) then
		DaemonPrince.strength_id = cpu_manager.stats:GetAbilityID( "chaos_daemon_strength" )	
	end

	if (DaemonPrince.roar_id == nil) then
		DaemonPrince.roar_id = cpu_manager.stats:GetAbilityID( "chaos_fear_roar" )	
	end
	
	if (DaemonPrince.blood_syphon_id == nil) then
		DaemonPrince.blood_syphon_id = cpu_manager.stats:GetAbilityID( "chaos_blood_syphon" )	
	end

	if (DaemonPrince.detector_id == nil) then
		DaemonPrince.detector_id = cpu_manager.stats:GetAbilityID( "chaos_detector" )	
	end	
end

function DaemonPrinceTactic:DoAbilities()

	Ability.DoAbility( self.squad_ai, DaemonPrince.strength_id, Ability.Filters.IsInCombat )
	Ability.DoAbilityArea( self.squad_ai, DaemonPrince.roar_id, Ability.Filters.CloseInfantryEnemy, 4 )
	Ability.DoAbilityTarget( self.squad_ai, DaemonPrince.blood_syphon_id, Ability.Filters.CloseInfantryEnemy, 1 )

	if (self.m_oTimedSpecialAbilities ~= nil) then
		self.m_oTimedSpecialAbilities:Call()
	else
		DaemonPrinceTactic.DoTimedSpecialAbilities(self)
	end
end

function DaemonPrinceTactic:DoTimedSpecialAbilities()

	-- Try to use detection ability
	if (self.squad_ai:CanDoAbility(DaemonPrince.detector_id)) then
	
		local oSquad = Ability.Filters.CloseInfiltratedEnemy(self.squad_ai:GetPosition(), 35, 1)
		if (oSquad ~= nil) then
			self.squad_ai:DoSpecialAbility(DaemonPrince.detector_id)
		end
	end
end